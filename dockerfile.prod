FROM  node:8-buster-slim
LABEL maintainer="contact@kalisio.xyz"

ARG APP
ARG BUILD_NUMBER

ENV BUILD_NUMBER=$BUILD_NUMBER
ENV NODE_APP_INSTANCE=prod
ENV DEBUG=

COPY . /opt/${APP}

WORKDIR /opt/${APP}
RUN yarn && yarn prod

WORKDIR /opt/${APP}/api
RUN yarn && yarn build

EXPOSE 8081

CMD [ "yarn", "prod" ]
